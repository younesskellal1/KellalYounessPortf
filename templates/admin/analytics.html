{% extends "admin/base.html" %}

{% block page_title %}Analytics Dashboard{% endblock %}

{% block content %}
<div class="analytics-header">
    <div class="header-content">
        <h2>Visitor Analytics</h2>
        <p>Track page views, popular sections, and visitor behavior</p>
    </div>
    <form method="POST" action="{{ url_for('admin_analytics_reset') }}" onsubmit="return confirm('Are you sure you want to reset all analytics data? This action cannot be undone.');">
        <button type="submit" class="btn btn-danger">
            <i class="fas fa-trash"></i>
            Reset Analytics
        </button>
    </form>
</div>

<!-- Summary Stats -->
<div class="analytics-stats-grid">
    <div class="analytics-stat-card">
        <div class="stat-icon-large">
            <i class="fas fa-eye"></i>
        </div>
        <div class="stat-content">
            <h3>{{ summary.total_views }}</h3>
            <p>Total Page Views</p>
        </div>
    </div>
    <div class="analytics-stat-card">
        <div class="stat-icon-large">
            <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
            <h3>{{ summary.unique_visitors }}</h3>
            <p>Unique Visitors</p>
        </div>
    </div>
    <div class="analytics-stat-card">
        <div class="stat-icon-large">
            <i class="fas fa-calendar-day"></i>
        </div>
        <div class="stat-content">
            <h3>{{ summary.avg_daily_views }}</h3>
            <p>Avg Daily Views (30 days)</p>
        </div>
    </div>
    <div class="analytics-stat-card">
        <div class="stat-icon-large">
            <i class="fas fa-session"></i>
        </div>
        <div class="stat-content">
            <h3>{{ summary.visitor_sessions }}</h3>
            <p>Visitor Sessions</p>
        </div>
    </div>
</div>

<!-- Charts and Tables Grid -->
<div class="analytics-grid">
    <!-- Top Pages -->
    <div class="analytics-card">
        <div class="analytics-card-header">
            <h3>
                <i class="fas fa-file-alt"></i>
                Top Pages
            </h3>
        </div>
        <div class="analytics-card-body">
            {% if summary.top_pages %}
            <div class="analytics-list">
                {% for page, views in summary.top_pages %}
                <div class="analytics-item">
                    <div class="analytics-item-info">
                        <span class="analytics-item-name">{{ page }}</span>
                        <span class="analytics-item-views">{{ views }} views</span>
                    </div>
                    <div class="analytics-bar-container">
                        <div class="analytics-bar" style="width: {{ (views / summary.top_pages[0][1] * 100)|round }}%"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state-small">
                <i class="fas fa-chart-bar"></i>
                <p>No page views yet</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Popular Sections -->
    <div class="analytics-card">
        <div class="analytics-card-header">
            <h3>
                <i class="fas fa-th-large"></i>
                Popular Sections
            </h3>
        </div>
        <div class="analytics-card-body">
            {% if summary.top_sections %}
            <div class="analytics-list">
                {% for section, views in summary.top_sections %}
                <div class="analytics-item">
                    <div class="analytics-item-info">
                        <span class="analytics-item-name">{{ section|title }}</span>
                        <span class="analytics-item-views">{{ views }} views</span>
                    </div>
                    <div class="analytics-bar-container">
                        <div class="analytics-bar" style="width: {{ (views / (summary.top_sections[0][1] if summary.top_sections else 1) * 100)|round }}%"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state-small">
                <i class="fas fa-th-large"></i>
                <p>No section views yet</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Daily Views Chart -->
<div class="analytics-card analytics-card-full">
    <div class="analytics-card-header">
        <h3>
            <i class="fas fa-chart-line"></i>
            Daily Views (Last 30 Days)
        </h3>
    </div>
    <div class="analytics-card-body">
        {% if summary.daily_views %}
        <div class="daily-views-chart">
            {% for date, views in summary.daily_views|reverse %}
            <div class="daily-view-item">
                <div class="daily-view-bar" style="height: {{ (views / (summary.daily_views|map(attribute=1)|max if summary.daily_views else 1) * 100)|round }}%"></div>
                <div class="daily-view-info">
                    <span class="daily-view-date">{{ date }}</span>
                    <span class="daily-view-count">{{ views }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state-small">
            <i class="fas fa-chart-line"></i>
            <p>No daily views data yet</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

